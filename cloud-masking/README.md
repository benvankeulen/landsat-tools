# cfmask_diag - Diagnostic band for CFMask
This software exists to provide a diagnostic band for cloud confidence band generated by the C version of Fmask (CFMask), a cloud masking algorithm for Landsat TM/ETM+/OLI-TIRS imagery.

## Overview
The software takes Top of Atmosphere (TOA) Reflectance data, runs the CFMask confidence algorithm, and outputs a diagnostic band that indicates which tests passed/failed in CFMask.

## Requirements
* Python 2.7.x/3.x or greater
* gdal (osgeo)
* numpy

## Supported file types
* GeoTIFFs delivered using the EROS Science Processing Architecture (ESPA; https://espa.cr.usgs.gov/) naming convention, in a .tar.gz archive.

## Features
* Provides a pass/fail flag for each test performed by the CFMask cloud confidence routine, re-implemented from the potential_cloud_shadow_snow_mask.c application (https://github.com/USGS-EROS/espa-cloud-masking/blob/master/cfmask/src/.)
* Currently provides water and land probability masks, which can be commented out within the code.

## Caveats
Only does cloud probability tests; missing features from original CFMask code, specifically:
* Cloud dilation
* Cloud shadow, cloud shadow dilation
* Cirrus band addition (OLI-TIRS only)
* Disable thermal band

## Using cfmask_diag
cfmask_diag.py 
  
  * Required:
    * -i /path/to/input_landsat_toa_reflectance.tar.gz
  
  * Optional
    * -cloud_prob_threshold Set the cloud probability threshold (default=22.5)
    * -t_buffer Set the temperature buffer probability (default=400.0)

## Example use
```bash
$ python cfmask_diag.py -i /path/to/input_landsat_toa_reflectance.tar.gz 
```

